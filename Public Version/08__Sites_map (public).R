
## creating a map of survey plots in oak femels and the ambient forest

library(raster)
library(sf)
library(openxlsx)

options(digits=10)

# converting LL plots coordinate data

# Data frame with UTM coordinates
shape_coordinates <- data.frame(
                  x = c(314098.2524, 313844.6384, 313992.4989, 314008.0148, 313151.7162, 
                         313147.2472, 313340.0152, 313228.1915, 313523.5272, 313353.6449,
                         312709.1264, 312710.5188, 312651.4474, 312503.7256, 312420.0409,
                         312346.0805, 312263.3110, 312116.1250, 312086.4344, 311781.1080,
                         311705.4855, 311613.2025, 311694.7769, 311586.1377, 311585.2307,
                         311639.8028, 311514.5829, 311361.3788, 311234.0167, 311855.7791,
                         308705.9691, 308606.4497, 310125.2174, 310425.2501, 309331.2622,
                         309147.6381, 309185.1483, 309055.6176, 308967.0671, 308324.9826, 
                         308121.6768, 306410.8304, 306206.0898, 305970.5152, 305868.7418,
                         305389.5351, 305145.1663, 304633.0161, 304887.8208, 305235.2757,
                         306714.9961, 304935.5410, 307363.9678, 307360.7296, 307581.6062,
                         305329.7743, 307951.9451, 309135.4833, 306564.2776, 312355.6486),
                   y = c(5692026.320, 5692214.132, 5692239.492, 5692434.796, 5693198.181,
                         5693306.380, 5693286.119, 5693414.936, 5693534.221, 5693661.852,
                         5693520.761, 5693672.632, 5693876.016, 5693807.085, 5693852.976,
                         5693627.635, 5693836.294, 5693880.716, 5693770.986, 5694094.402,
                         5694148.867, 5694188.807, 5693884.650, 5693833.383, 5693950.026,
                         5694060.799, 5694097.711, 5694164.066, 5694400.202, 5693917.482,
                         5695799.157, 5695678.383, 5694868.142, 5694153.863, 5695057.485,
                         5694526.456, 5694232.909, 5694980.449, 5695169.651, 5694605.233,
                         5694302.695, 5695030.612, 5695046.153, 5695254.414, 5695341.398,
                         5695662.195, 5695672.332, 5695519.921, 5695888.270, 5696122.661,
                         5695419.300, 5696505.014, 5696373.498, 5696622.025, 5695259.284,
                         5696513.237, 5695199.448, 5695041.603, 5695023.674, 5694095.486))

# Create sf object with UTM coordinates (EPSG:25833)
utm_crs <- st_crs(25833)
data_sf <- st_as_sf(shape_coordinates, coords = c("x", "y"), crs = utm_crs)

# Transform coordinates to latitude and longitude (EPSG:4326)
data_wgs84 <- st_transform(data_sf, crs = 4326)

# Extract latitude and longitude
latitude <- st_coordinates(data_wgs84)[, "Y"]
longitude <- st_coordinates(data_wgs84)[, "X"]

# # Print transformed coordinates
# print(data.frame(latitude, longitude))

#country shapefile
ma.s.country <- getData("GADM", country="DE", level=1)

# loading DEM tile
ma.dem.1 <- getData("SRTM", lon=12, lat=51)
ma.dem.2 <- getData("SRTM", lon=7, lat=51)
ma.dem.3 <- getData("SRTM", lon=12, lat=47)
ma.dem.4 <- getData("SRTM", lon=7, lat=47)
ma.dem.5 <- getData("SRTM", lon=3, lat=47)
ma.dem.6 <- getData("SRTM", lon=17, lat=47)
ma.dem.7 <- getData("SRTM", lon=3, lat=51)
ma.dem.8 <- getData("SRTM", lon=17, lat=51)

# merging DEM tiles at country-level
ma.dem <- mosaic(ma.dem.1, ma.dem.2, ma.dem.3, ma.dem.4, ma.dem.5, ma.dem.6, ma.dem.7, ma.dem.8, fun=mean)

# cropping the DEM tile
ma.dem.country <- crop(ma.dem, extent(5.7, 15, 47.3, 55))


# Overview map terrain colour
over.col <- colorRampPalette(c("white", "grey35"))

# Plot overview map
plot(ma.dem.country, col=over.col(100), axes=FALSE, legend=FALSE)
plot(ma.s.country, add=TRUE)

# Bounding box
rect(12.2, 51.2, 12.6, 51.4, border="red", lwd=3)

# cropping at smaller scale
ma.dem.local <- crop(ma.dem, extent(12.18, 12.4, 51.3, 51.4))

plot(ma.dem.local, col=over.col(100), legend=FALSE)

# LL plot locations
LL.2013.latitude <- c(51.3490608376309,51.3506647870818,51.3509409869402,51.3527003199978,51.3592762099372,51.3602465912812,51.3601279708114,51.3612482651697,51.3624167116766,51.3635073155959,51.3620279067812,51.3633924739626,51.3651997926743,51.3645319150749,51.3649164796649,51.3628680440002,51.3647148659182,51.3650651994583,51.3640697891609,51.3668736018005,51.367337737482,51.3676658746495,51.3649610157455,51.3644645172791,51.3655118915648,51.3665249419847,51.3668149433946,51.3673600763205,51.3694387021479,51.3653092588163,51.3670734311693)
LL.2013.longitude <- c(12.3303887914069,12.3266528287253,12.328760495779,12.3288809829433,12.3161968118902,12.3160758592301,12.3188521241638,12.3171801578914,12.3213548813842,12.3188504879912,12.3096773125154,12.3096173111176,12.3086626151728,12.3065793944912,12.3053544674452,12.3044121740352,12.3031144774666,12.3009791606804,12.3006111376082,12.2960591577742,12.2949452261468,12.2935999066014,12.2949314941848,12.2933998882593,12.2933250708416,12.2940494079303,12.2922331097168,12.2899996299903,12.2880467590604,12.2972242092556,12.3043025736967)

LL.2016.latitude <- c(51.3811576811468,51.3800394027788,51.3732720134565,51.3669567690536,51.374706607163,51.3698754223648,51.367251495332,51.3739220806379,51.3755916346715,51.3703059259871,51.3675200272566,51.3734771737158,51.3735469204094,51.3753369285678,51.3760833698175,51.378800478726,51.3788077095017,51.3772628957359,51.3806587029605,51.3828831099659,51.3770717229282,51.3862141623893,51.3858623045147,51.3880933247812,51.3759288854041,51.3864233547092,51.3755168432182,51.3744981910439,51.373467149762)
LL.2016.longitude <- c(12.2510185233641,12.2496552162993,12.271886304651,12.2765728328153,12.2603911871475,12.258041168159,12.2587369609842,12.2564768704552,12.2551044299612,12.2461943058297,12.2434403119187,12.2184965392047,12.2155500667471,12.2120559127117,12.2105479104513,12.2034953494753,12.1999827718977,12.192716569071,12.1961709508646,12.2010290919048,12.2226499021806,12.1965171548828,12.2314459951564,12.2312647100367,12.2351734274871,12.2021713381187,12.2405204629453,12.2575901418404,12.2207022686267)

# Sachsenforst plot locations
Sachsenforst.latitude <- c(51.369581, 51.367445, 51.367303, 51.366132)
Sachsenforst.longitude <- c(12.247742, 12.245612, 12.247468, 12.24768)

#Femel 18 (0.3 ha) 51.369581, 12.247742
#Femel 15 (0.4 ha) 51.367445, 12.245612
#Femel 16 (0.5 ha) 51.367303, 12.247468
#Femel 17 (0.6 ha) 51.366132, 12.24768


# Paußnitz plot location
Paußnitz.latitude <- c(51.315553)
Paußnitz.longitude <- c(12.352058)

# Leipzig city center
Leipzig.latitude <- c(51.340500)
Leipzig.longitude <- c(12.374696)

# Add points to map
points(LL.2013.longitude, LL.2013.latitude, pch=21, col="darkgreen", bg="darkgreen", cex=1)
points(LL.2016.longitude, LL.2016.latitude, pch=21, col="blue", bg="blue", cex=1)
points(Sachsenforst.longitude, Sachsenforst.latitude, pch=21, col="yellow", bg="yellow", cex=1)
points(Paußnitz.longitude, Paußnitz.latitude, pch=21, col="yellow", bg="yellow", cex=1)
points(Leipzig.longitude, Leipzig.latitude, pch=1, col="red3", bg="red3", cex=6, lwd=4)
text(12.3715, 51.33650, labels="     Leipzig
     (city center)", 51.33650, cex=1, pos=1)

scalebar(d=4, below="km", type="bar", divs=4, xy=c(12.335,51.305), lonlat=TRUE, cex=1.3)

x_legend <- 12.18
y_legend <- 51.363

legend(x_legend, y_legend, legend=c("Oak Femels", "2013-2020 LL Plots", "2016-2020 LL Plots"), pch=c(21, 21, 21), pt.bg=c("yellow", "darkgreen", "blue"), pt.cex=2.5)
